# Memory Thread MVP PRD

## 🎯 핵심 정보

**목적**: 가족이 입력한 어르신의 인생 맥락을 AI가 통째로 기억하고, 먼저 말을 건네는 방식으로 어르신의 기억과 감정을 자극하는 비의료적 인지 자극 말벗 서비스
**사용자**: 스마트폰 사용이 익숙하지 않은 고령 어르신 (4자리 PIN 로그인), 어르신의 인생 맥락을 등록·관리하는 가족 구성원 (하드코딩된 ID/비밀번호 로그인)

---

## 🚶 사용자 여정

### 어르신 플로우
```
1. 홈 페이지
   ↓ [어르신 로그인] 버튼 클릭

2. 어르신 로그인 페이지
   ↓ 4자리 PIN 입력 (F010)

3. 채팅 페이지
   ├── Gemini가 등록된 컨텍스트 기반으로 먼저 질문 시작 (F007)
   ├── 어르신 텍스트 입력 → AI 맥락 기반 역질문 응답 (F006)
   └── 3번 대화 완료 → 포인트 +10 자동 지급 (F008)
       ↓
4. 뱃지 페이지 (헤더 뱃지 버튼 클릭)
   └── 포인트 현황 확인 + 뱃지 컬렉션 열람 (F009)
```

### 가족 플로우
```
1. 홈 페이지
   ↓ [가족 관리] 버튼 클릭

2. 가족 로그인 페이지
   ↓ ID/비밀번호 입력 (F001)
   └── 로그인 성공 → 관리 대시보드 자동 이동

3. 관리 대시보드
   ├── [어르신 추가] 버튼 → 이름 + PIN 입력 → 저장 (F002)
   └── 등록된 어르신 카드 클릭 → 어르신 관리 페이지 이동

4. 어르신 관리 페이지
   ├── 탭1: 텍스트 컨텍스트 → 6카테고리 입력/수정/저장 (F003)
   ├── 탭2: 이미지 관리 → 가족 사진 업로드/캡션 입력/삭제 (F004)
   └── 탭3: 로그인 설정 → PIN 변경 (F011)
```

---

## ⚡ 기능 명세

### 1. MVP 핵심 기능

| ID | 기능명 | 설명 | MVP 필수 이유 | 관련 페이지 |
|----|--------|------|-------------|------------|
| **F010** | 어르신 PIN 로그인 | 4자리 PIN 입력으로 어르신 본인 인증 후 채팅 진입 | 보안 유지하면서도 간편한 인증 | 어르신 로그인 페이지 |
| **F006** | AI 기억 대화 | Gemini 1.5 Pro 1M context에 전체 컨텍스트 전달하여 맥락 기반 대화 | 핵심 가치: RAG 없이 인생 전체 맥락 이해 | 채팅 페이지 |
| **F007** | 맥락 기반 역질문 생성 | AI가 먼저 어르신에게 기억 자극 질문을 건네며 대화 시작 | 어르신이 먼저 입력하지 않아도 되는 핵심 UX | 채팅 페이지 |
| **F003** | 텍스트 컨텍스트 관리 | 고향/가족/직업/취미/추억/건강 6카테고리 컨텍스트 CRUD | AI 대화 품질의 직접적 기반 데이터 | 어르신 관리 페이지 |
| **F004** | 이미지 컨텍스트 관리 | 가족 사진 업로드·삭제, 캡션 입력 (Supabase Storage) | 시각적 기억 자극 + 멀티모달 AI 활용 | 어르신 관리 페이지 |

### 2. MVP 필수 지원 기능

| ID | 기능명 | 설명 | MVP 필수 이유 | 관련 페이지 |
|----|--------|------|-------------|------------|
| **F001** | 가족 로그인/로그아웃 | 하드코딩된 ID/비밀번호로 가족 계정 인증 | 어르신 데이터 보호를 위한 최소 인증 | 가족 로그인 페이지 |
| **F002** | 어르신 등록 및 목록 관리 | 가족이 어르신 이름 + PIN 등록, 가족-어르신 매핑 | 어르신 데이터와 가족 계정 연결 | 관리 대시보드 |
| **F011** | 어르신 PIN 관리 | 가족이 어르신 PIN 변경 | 어르신 로그인 정보 관리 | 어르신 관리 페이지 |
| **F008** | 포인트 지급 | 3번 대화 완료 시 +10점 자동 지급 | 어르신 대화 지속 동기 부여 | 채팅 페이지 |
| **F009** | 뱃지 시스템 | 100점 달성 시 뱃지 획득, 포인트/뱃지 현황 시각화 | 성취감과 지속적 사용 유도 | 뱃지 페이지 |

### 3. MVP 이후 기능 (제외)

- 프로필 상세 관리 (아바타, 자기소개 등)
- 음성 입력/TTS 변환
- 대화 기록 내보내기
- 가족 공유 기능 (여러 가족 계정 공동 관리)
- 실시간 알림 시스템
- 회원가입 기능 (가족 계정 하드코딩으로 대체)
- 비밀번호 암호화 (해커톤용 평문 저장)

---

## 📱 메뉴 구조

```
📱 Memory Thread 내비게이션

🏠 홈 (비로그인 기본 화면)
├── [어르신 로그인] 버튼 - F010 (어르신 PIN 로그인 페이지로 이동)
└── [가족 관리] 버튼 - F001 (가족 로그인 페이지로 이동)

👵 어르신 메뉴 (PIN 로그인 후)
├── 💬 채팅 페이지 - F006, F007, F008 (AI 기억 대화)
└── 🏅 뱃지 페이지 - F009 (포인트/뱃지 현황)

👨‍👩‍👧 가족 메뉴 (이메일 로그인 후)
├── 🔐 가족 로그인 페이지 - F001 (이메일 로그인/로그아웃)
├── 📋 관리 대시보드 - F002 (어르신 목록 + 추가)
└── ⚙️ 어르신 관리 페이지
    ├── 탭1: 텍스트 컨텍스트 - F003 (6카테고리 관리)
    ├── 탭2: 이미지 관리 - F004 (사진 업로드/삭제)
    └── 탭3: 로그인 설정 - F011 (PIN 변경)
```

---

## 📄 페이지별 상세 기능

### 홈 페이지

> **구현 기능:** 없음 (진입점) | **인증:** 불필요 (공개 페이지)

| 항목 | 내용 |
|------|------|
| **역할** | 앱의 진입점. 어르신과 가족이 각자의 로그인 페이지로 이동 |
| **진입 경로** | 앱 최초 접속 시 자동 진입 |
| **사용자 행동** | 어르신: [어르신 로그인] 버튼 클릭 → 어르신 로그인 페이지 이동 / 가족: [가족 관리] 버튼 클릭 → 가족 로그인 페이지 이동 |
| **주요 기능** | • **[어르신 로그인]** 버튼 (큰 글씨, 고대비 UI) → 어르신 로그인 페이지 이동<br>• **[가족 관리]** 버튼 → 가족 로그인 페이지 이동<br>• 앱 로고 및 간단한 소개 문구 표시 |
| **다음 이동** | [어르신 로그인] → 어르신 로그인 페이지, [가족 관리] → 가족 로그인 페이지 |

---

### 어르신 로그인 페이지

> **구현 기능:** `F010` | **인증:** 어르신 PIN 인증

| 항목 | 내용 |
|------|------|
| **역할** | 어르신이 4자리 PIN으로 간편하게 본인 인증 |
| **진입 경로** | 홈 페이지 [어르신 로그인] 버튼 클릭 |
| **사용자 행동** | 큰 숫자 키패드로 4자리 PIN 입력 후 채팅 페이지 이동 |
| **주요 기능** | • 큰 숫자 키패드 (0-9) 표시<br>• PIN 입력 필드 (4자리, 마스킹 처리 ••••)<br>• **[확인]** 버튼 → PIN 검증 후 채팅 페이지 이동<br>• PIN 불일치 시 "PIN이 올바르지 않습니다" 에러 메시지<br>• [뒤로가기] 버튼 → 홈 페이지 이동 |
| **다음 이동** | 성공 → 채팅 페이지, 실패 → 에러 표시 후 동일 페이지 유지 |

---

### 가족 로그인 페이지

> **구현 기능:** `F001` | **인증:** 가족 계정 로그인 전용

| 항목 | 내용 |
|------|------|
| **역할** | 가족 계정 ID/비밀번호 인증 전용 페이지 (하드코딩된 계정 사용) |
| **진입 경로** | 홈 페이지 [가족 관리] 버튼 클릭 |
| **사용자 행동** | ID와 비밀번호 입력 후 [로그인] 버튼 클릭 |
| **주요 기능** | • ID 입력 필드<br>• 비밀번호 입력 필드 (표시/숨김 토글)<br>• **[로그인]** 버튼 → Supabase DB에서 평문 비밀번호 매칭 확인<br>• 로그인 실패 시 "ID 또는 비밀번호가 올바르지 않습니다" 에러 메시지<br>• [뒤로가기] 버튼 → 홈 페이지 이동 |
| **다음 이동** | 성공 → 관리 대시보드, 실패 → 에러 표시 후 동일 페이지 유지 |

---

### 관리 대시보드

> **구현 기능:** `F002` | **인증:** 가족 계정 로그인 필수

| 항목 | 내용 |
|------|------|
| **역할** | 가족 계정에 연결된 어르신 목록 관리 및 신규 어르신 등록 |
| **진입 경로** | 가족 로그인 성공 후 자동 리디렉션 |
| **사용자 행동** | 등록된 어르신 카드 목록 확인, [어르신 추가] 버튼으로 새 어르신 등록, 기존 카드 클릭으로 관리 페이지 이동 |
| **주요 기능** | • 로그인한 가족 계정에 연결된 어르신 카드 목록<br>• **[어르신 추가]** 버튼 → 이름 + 4자리 PIN 입력 모달 → 저장<br>• 어르신 카드 클릭 → 어르신 관리 페이지 이동<br>• [로그아웃] 버튼 → 홈 페이지 이동 |
| **다음 이동** | 어르신 카드 클릭 → 어르신 관리 페이지, 로그아웃 → 홈 페이지 |

---

### 어르신 관리 페이지

> **구현 기능:** `F003`, `F004`, `F011` | **인증:** 가족 계정 로그인 필수

| 항목 | 내용 |
|------|------|
| **역할** | 특정 어르신의 AI 대화 품질을 결정하는 텍스트/이미지 컨텍스트 및 로그인 정보 관리 |
| **진입 경로** | 관리 대시보드에서 어르신 카드 클릭 |
| **사용자 행동** | 탭1에서 6카테고리 텍스트 컨텍스트 입력/수정, 탭2에서 가족 사진 업로드 및 캡션 등록, 탭3에서 PIN 변경 |
| **주요 기능** | • **탭1 - 텍스트 컨텍스트**: 고향/가족/직업/취미/추억/건강 6카테고리 텍스트 입력 및 저장<br>• **탭2 - 이미지 관리**: 사진 파일 업로드 (Supabase Storage), 캡션 입력, 업로드된 이미지 목록/삭제<br>• **탭3 - 로그인 설정**: 4자리 PIN 변경 (현재 PIN 표시 안함, 새 PIN 입력 후 저장)<br>• [저장] 버튼 → 각 탭별 정보 즉시 저장<br>• 뒤로가기 → 관리 대시보드 이동 |
| **다음 이동** | 저장 성공 → 동일 페이지 (성공 토스트), 뒤로가기 → 관리 대시보드 |

---

### 채팅 페이지

> **구현 기능:** `F006`, `F007`, `F008` | **인증:** 어르신 PIN 로그인 필수

| 항목 | 내용 |
|------|------|
| **역할** | 어르신이 AI와 기억·감정 대화를 나누는 핵심 페이지. Gemini 1.5 Pro가 전체 컨텍스트를 기반으로 대화 주도 |
| **진입 경로** | 어르신 로그인 페이지에서 PIN 인증 성공 후 자동 이동 |
| **사용자 행동** | AI가 먼저 건네는 질문을 읽고 텍스트로 응답, 이후 AI와 자연스러운 대화 진행 |
| **주요 기능** | • 페이지 진입 시 Gemini가 등록된 컨텍스트 기반으로 첫 질문 자동 생성<br>• 텍스트 입력창 + [전송] 버튼으로 어르신 응답 전송<br>• Gemini 1.5 Pro 1M context에 전체 텍스트+이미지 컨텍스트 + 대화 기록 일괄 전달<br>• 3번 대화 완료 감지 → 자동으로 +10 포인트 지급 + 완료 메시지 표시<br>• [로그아웃] 버튼 → 홈 페이지 이동 |
| **다음 이동** | 포인트 획득 알림 클릭 → 뱃지 페이지, 로그아웃 → 홈 페이지 |

---

### 뱃지 페이지

> **구현 기능:** `F009` | **인증:** 어르신 PIN 로그인 필수

| 항목 | 내용 |
|------|------|
| **역할** | 어르신의 누적 포인트와 획득한 뱃지를 시각적으로 확인하는 동기 부여 페이지 |
| **진입 경로** | 채팅 페이지 포인트 획득 알림 클릭 또는 헤더 뱃지 아이콘 클릭 |
| **사용자 행동** | 현재 포인트 확인, 획득한 뱃지와 미획득 뱃지(잠금 상태) 열람 |
| **주요 기능** | • 현재 총 포인트 표시 (큰 숫자, 강조 디자인)<br>• 뱃지 컬렉션 그리드 (100점 단위 뱃지, 획득/미획득 상태 표시)<br>• 다음 뱃지까지 남은 포인트 진행 바 표시<br>• [채팅으로] 버튼 → 채팅 페이지 이동 |
| **다음 이동** | [채팅으로] 클릭 → 채팅 페이지 |

---

## 🗄️ 데이터 모델

### family_users (가족 계정 — 하드코딩)
| 필드 | 설명 | 타입/관계 |
|------|------|----------|
| id | 고유 식별자 | UUID |
| username | 가족 ID | TEXT (UNIQUE) |
| password | 비밀번호 (평문 저장) | TEXT |
| name | 가족 이름 | TEXT |
| created_at | 계정 생성 일시 | TIMESTAMP |

**하드코딩 예시 데이터:**
```sql
INSERT INTO family_users (username, password, name) VALUES
  ('family1', 'password123', '김가족'),
  ('family2', 'password456', '이가족');
```

### elders (어르신 프로필)
| 필드 | 설명 | 타입/관계 |
|------|------|----------|
| id | 고유 식별자 | UUID |
| family_user_id | 등록한 가족 계정 | → family_users.id |
| name | 어르신 이름 | TEXT |
| pin_code | 로그인 PIN (평문 저장) | TEXT (4자리) |
| total_points | 누적 포인트 | INTEGER |
| badge_count | 획득 뱃지 수 | INTEGER |
| created_at | 등록 일시 | TIMESTAMP |

### context_texts (텍스트 컨텍스트 — 6카테고리)
| 필드 | 설명 | 타입/관계 |
|------|------|----------|
| id | 고유 식별자 | UUID |
| elder_id | 연결된 어르신 | → elders.id |
| category | 카테고리 (고향/가족/직업/취미/추억/건강) | TEXT |
| content | 컨텍스트 내용 | TEXT |
| created_at | 생성/수정 일시 | TIMESTAMP |

### context_images (이미지 컨텍스트)
| 필드 | 설명 | 타입/관계 |
|------|------|----------|
| id | 고유 식별자 | UUID |
| elder_id | 연결된 어르신 | → elders.id |
| image_url | Supabase Storage URL | TEXT |
| caption | 이미지 설명/캡션 | TEXT |
| created_at | 업로드 일시 | TIMESTAMP |

### messages (대화 기록)
| 필드 | 설명 | 타입/관계 |
|------|------|----------|
| id | 고유 식별자 | UUID |
| elder_id | 연결된 어르신 | → elders.id |
| session_id | 소속 세션 | → sessions.id |
| role | 발화자 (user/assistant) | TEXT |
| content | 메시지 내용 | TEXT |
| created_at | 메시지 생성 일시 | TIMESTAMP |

### sessions (대화 세션)
| 필드 | 설명 | 타입/관계 |
|------|------|----------|
| id | 고유 식별자 | UUID |
| elder_id | 연결된 어르신 | → elders.id |
| message_count | 현재 대화 횟수 | INTEGER |
| is_completed | 3회 완료 여부 | BOOLEAN |
| created_at | 세션 시작 일시 | TIMESTAMP |

---

## 🛠️ 기술 스택 (최신 버전)

### 🎨 프론트엔드 프레임워크

- **Next.js 15** (App Router) - React 풀스택 프레임워크
- **TypeScript 5.6+** - 타입 안전성 보장
- **React 19** - UI 라이브러리 (최신 동시성 기능)

### 🎨 스타일링 & UI

- **TailwindCSS v4** (설정파일 없는 새로운 엔진) - 유틸리티 CSS 프레임워크
- **shadcn/ui** - 고품질 React 컴포넌트 라이브러리
- **Lucide React** - 아이콘 라이브러리

### 🤖 AI

- **Google Gemini 1.5 Pro** (1M context window) - 전체 컨텍스트 기반 대화 생성
- **@google/generative-ai SDK** - Gemini API 클라이언트

### 🗄️ 백엔드 & 데이터베이스

- **Supabase** - BaaS (PostgreSQL + Storage)
- **PostgreSQL** - 관계형 데이터베이스 (Supabase 내장)
  - 가족 계정: 하드코딩된 ID/비밀번호 (평문 저장)
  - 어르신 PIN: 평문 저장 (4자리)

### 🚀 배포 & 호스팅

- **Vercel** - Next.js 15 최적화 배포 플랫폼

### 📦 패키지 관리

- **npm** - 의존성 관리

---

## ✅ 정합성 검증 체크리스트

### 🔍 1단계: 기능 명세 → 페이지 연결 검증

- [x] F001 (가족 이메일 로그인) → 가족 로그인 페이지 ✓
- [x] F002 (어르신 등록 및 목록 관리) → 관리 대시보드 ✓
- [x] F003 (텍스트 컨텍스트 관리) → 어르신 관리 페이지 ✓
- [x] F004 (이미지 컨텍스트 관리) → 어르신 관리 페이지 ✓
- [x] F006 (AI 기억 대화) → 채팅 페이지 ✓
- [x] F007 (맥락 기반 역질문 생성) → 채팅 페이지 ✓
- [x] F008 (포인트 지급) → 채팅 페이지 ✓
- [x] F009 (뱃지 시스템) → 뱃지 페이지 ✓
- [x] F010 (어르신 PIN 로그인) → 어르신 로그인 페이지 ✓
- [x] F011 (어르신 PIN 관리) → 어르신 관리 페이지 ✓

### 🔍 2단계: 메뉴 구조 → 페이지 연결 검증

- [x] 홈 → 홈 페이지 존재 ✓
- [x] 어르신 로그인 페이지 → 어르신 로그인 페이지 존재 ✓
- [x] 가족 로그인 페이지 → 가족 로그인 페이지 존재 ✓
- [x] 관리 대시보드 → 관리 대시보드 존재 ✓
- [x] 어르신 관리 페이지 → 어르신 관리 페이지 존재 ✓
- [x] 채팅 페이지 → 채팅 페이지 존재 ✓
- [x] 뱃지 페이지 → 뱃지 페이지 존재 ✓

### 🔍 3단계: 페이지별 상세 기능 → 역참조 검증

- [x] 홈 페이지 구현 기능 없음 (진입점) ✓
- [x] 어르신 로그인 페이지 구현 기능 F010 → 기능 명세에 정의 ✓
- [x] 가족 로그인 페이지 구현 기능 F001 → 기능 명세에 정의 ✓
- [x] 관리 대시보드 구현 기능 F002 → 기능 명세에 정의 ✓
- [x] 어르신 관리 페이지 구현 기능 F003, F004, F011 → 기능 명세에 정의 ✓
- [x] 채팅 페이지 구현 기능 F006, F007, F008 → 기능 명세에 정의 ✓
- [x] 뱃지 페이지 구현 기능 F009 → 기능 명세에 정의 ✓

### 🔍 4단계: 누락 및 고아 항목 검증

- [x] 기능 명세에만 있고 페이지 미구현 기능: 없음 ✓
- [x] 페이지에만 있고 기능 명세 미정의 기능: 없음 ✓
- [x] 메뉴에만 있고 실제 페이지 없는 항목: 없음 ✓

**검증 결과: 전체 정합성 확인 완료**
